"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.checkOrigin = exports.getAllOrigins = exports.getOriginsFromUrl = exports.remixOrgins = void 0;
const tslib_1 = require("tslib");
// Old link: 'https://raw.githubusercontent.com/ethereum/remix-plugin/master/projects/client/assets/origins.json'
exports.remixOrgins = 'https://gist.githubusercontent.com/EthereumRemix/091ccc57986452bbb33f57abfb13d173/raw/3367e019335746b73288e3710af2922d4c8ef5a3/origins.json';
/** Fetch the default origins for remix */
function getOriginsFromUrl(url) {
    return tslib_1.__awaiter(this, void 0, void 0, function* () {
        const res = yield fetch(url);
        return res.json();
    });
}
exports.getOriginsFromUrl = getOriginsFromUrl;
/** Get all the origins */
function getAllOrigins(options) {
    return tslib_1.__awaiter(this, void 0, void 0, function* () {
        const { devMode, allowOrigins } = options;
        const localhost = devMode.port ? [
            `http://127.0.0.1:${devMode.port}`,
            `http://localhost:${devMode.port}`,
            `https://127.0.0.1:${devMode.port}`,
            `https://localhost:${devMode.port}`,
        ] : [];
        const devOrigins = devMode.origins
            ? (typeof devMode.origins === 'string') ? [devMode.origins] : devMode.origins
            : [];
        const defaultOrigins = yield getOriginsFromUrl(allowOrigins);
        return [...defaultOrigins, ...localhost, ...devOrigins];
    });
}
exports.getAllOrigins = getAllOrigins;
/**
 * Check if the sender has the right origin
 * @param origin The origin of the incoming message
 * @param options client plugin options
 */
function checkOrigin(origin, options = {}) {
    return tslib_1.__awaiter(this, void 0, void 0, function* () {
        if (options.allowOrigins) {
            if (Array.isArray(options.allowOrigins)) {
                return options.allowOrigins.includes(origin);
            }
            else {
                const allOrigins = yield getAllOrigins(options);
                return allOrigins.includes(origin);
            }
        }
        return true;
    });
}
exports.checkOrigin = checkOrigin;
//# sourceMappingURL=origin.js.map